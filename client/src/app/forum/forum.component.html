<div class="forum-container">
  <!--All Posts-->
  <div *ngIf="!showPost">
    <div class="app-error-container">
      <app-error></app-error>
    </div>
    <button class="forum-btn alguru-primary-btn" (click)="onAddNewPostClick()">
      {{ addNewPost ? 'Cancel' : 'Add new post' }}
    </button>
    <div class="container welcome" *ngIf="posts.length === 0 && !addNewPost">
      <h1>Welcome to Alguru forum.</h1>
      <h3>There are no posts at this moment. Be the first!</h3>
    </div>
    <!--Add new Post mode-->
    <div class="container" *ngIf="addNewPost">
      <div class="form-group green-border-focus">
        <label for="titleTextarea1">Title:</label>
        <textarea
          class="title-input"
          id="titleTextarea1"
          rows="1"
          #newPostTitle
          [(ngModel)]="titleDefaultValue"
        ></textarea>
        <div class="error-message" *ngIf="isEmptyTitle">Title can not be empty</div>
        <div class="message">Message:</div>
        <angular-editor id="editor1" [config]="getEditorConfig()" [(ngModel)]="messageDefaultValue"></angular-editor>
        <div class="error-message" *ngIf="isEmptyMessage">Message can not be empty</div>
      </div>
      <button class="forum-btn alguru-primary-btn" (click)="onSubmitPost(newPostTitle.value, messageDefaultValue)">
        Submit
      </button>
      <button class="forum-btn alguru-primary-btn" (click)="onAddNewPostClick()">
        Cancel
      </button>
    </div>
    <!--Regular Mode-->
    <div class="container starter" *ngFor="let post of posts.slice().reverse()">
      <div class="clickable" (click)="onPostClick(post)" *ngIf="!post.onEditPostMode">
        <div class="respect-padding">
          <div class="edits">
            <div class="edits-btn-container">
              <button
                class="edits-btn"
                *ngIf="post.titles.length > 1"
                (click)="onShowEdits(post); $event.stopPropagation()"
              >
                edits
              </button>
            </div>
            <div class="pop-up" *ngIf="post.showEdits">
              <div *ngFor="let date of post.dates">
                <button
                  [ngClass]="date === post.currentDate ? 'edit-date current-date' : 'edit-date'"
                  (click)="onEditDateClicked($event, post, date); $event.stopPropagation()"
                >
                  {{ getDate(date) }}
                </button>
              </div>
            </div>
          </div>
        </div>
        <h4 class="title">{{ post.currentTitle }}</h4>
        <div class="content">
          <div class="post-content" [innerHTML]="getShortDescription(post.currentContent)"></div>
          <div class="data-right">
            <div class="spacer"></div>
            <span> By: {{ post.author }} </span>
            <span> At: {{ getDate(post.currentDate) }}</span>
            <button
              class="alguru-secondary-btn"
              *ngIf="isAdmin || post.author === loggedInUsername"
              (click)="onDeletePostClick(post); $event.stopPropagation()"
            >
              Delete Post
            </button>
            <button
              class="alguru-secondary-btn"
              *ngIf="isAdmin || post.author === loggedInUsername"
              (click)="onEditPostClick(post); $event.stopPropagation()"
            >
              Edit Post
            </button>
          </div>
        </div>
      </div>
      <!--On Edit post mode-->
      <div *ngIf="post.onEditPostMode">
        <div class="form-group green-border-focus">
          <label for="titleTextarea3">Title:</label>
          <textarea class="title-input" id="titleTextarea3" rows="1" [(ngModel)]="post.currentTitle"></textarea>
          <div class="message">Message:</div>
          <angular-editor id="editor3" [config]="getEditorConfig()" [(ngModel)]="post.currentContent"></angular-editor>
        </div>
        <button class="forum-btn alguru-primary-btn" (click)="onSubmitPost()">
          Submit
        </button>
        <button class="forum-btn alguru-primary-btn" (click)="onEditPostClick(null)">
          Cancel
        </button>
      </div>
    </div>
  </div>
  <!-- Post + Comments -->
  <!-- posts -->
  <div *ngIf="showPost">
    <button class="forum-btn alguru-primary-btn" (click)="onPostClick(null)">Back</button>
    <div class="container starter">
      <div *ngIf="!selectedPost.onEditPostMode">
        <div class="respect-padding">
          <div class="edits">
            <div class="edits-btn-container">
              <button
                class="edits-btn"
                *ngIf="selectedPost.titles.length > 1"
                (click)="onShowEdits(selectedPost); $event.stopPropagation()"
              >
                edits
              </button>
            </div>
            <div class="pop-up" *ngIf="selectedPost.showEdits">
              <div *ngFor="let date of selectedPost.dates">
                <button
                  [ngClass]="date === selectedPost.currentDate ? 'edit-date current-date' : 'edit-date'"
                  (click)="onEditDateClicked($event, selectedPost, date); $event.stopPropagation()"
                >
                  {{ getDate(date) }}
                </button>
              </div>
            </div>
          </div>
        </div>
        <h4 class="title">{{ selectedPost.currentTitle }}</h4>
        <div class="content">
          <div class="post-content" [innerHTML]="selectedPost.currentContent"></div>
          <div class="data-right">
            <div class="spacer"></div>
            <span> By: {{ selectedPost.author }} </span>
            <span> At: {{ getDate(selectedPost.currentDate) }}</span>
            <button
              class="alguru-secondary-btn"
              *ngIf="isAdmin || selectedPost.author === loggedInUsername"
              (click)="onDeletePostClick(selectedPost); $event.stopPropagation()"
            >
              Delete Post
            </button>
            <button
              class="alguru-secondary-btn"
              *ngIf="isAdmin || selectedPost.author === loggedInUsername"
              (click)="onEditPostClick(selectedPost); $event.stopPropagation()"
            >
              Edit Post
            </button>
          </div>
        </div>
      </div>
      <!-- edit selected post -->
      <div *ngIf="selectedPost.onEditPostMode">
        <div class="form-group green-border-focus">
          <label for="titleTextarea3">Title:</label>
          <textarea class="title-input" id="titleTextarea3" rows="1" [(ngModel)]="selectedPost.currentTitle"></textarea>
          <div class="message">Message:</div>
          <angular-editor
            id="editor3"
            [config]="getEditorConfig()"
            [(ngModel)]="selectedPost.currentContent"
          ></angular-editor>
        </div>
        <button class="forum-btn alguru-primary-btn" (click)="onSubmitPost()">
          Submit
        </button>
        <button class="forum-btn alguru-primary-btn" (click)="onEditPostClick(null)">
          Cancel
        </button>
      </div>
    </div>
    <!-- comments -->
    <div class="container" *ngFor="let comment of selectedPost.comments">
      <div class="comment-container" *ngIf="!comment.onEditPostMode">
        <div class="voting">
          <div class="vote vote-up" (click)="voteUp(comment)"></div>
          <div class="votes">{{ getCommentVotes(comment) }}</div>
          <div class="vote vote-down" (click)="voteDown(comment)"></div>
        </div>
        <div class="post-comment">
          <div class="respect-padding">
            <div class="edits">
              <div class="edits-btn-container">
                <button
                  class="edits-btn"
                  *ngIf="comment.titles.length > 1"
                  (click)="onShowEdits(comment); $event.stopPropagation()"
                >
                  edits
                </button>
              </div>
              <div class="pop-up" *ngIf="comment.showEdits">
                <div *ngFor="let date of comment.dates">
                  <button
                    [ngClass]="date === comment.currentDate ? 'edit-date current-date' : 'edit-date'"
                    (click)="onEditDateClicked($event, comment, date); $event.stopPropagation()"
                  >
                    {{ getDate(date) }}
                  </button>
                </div>
              </div>
            </div>
          </div>
          <h4 class="title">{{ comment.currentTitle }}</h4>
          <div class="content">
            <div class="post-content" [innerHTML]="comment.currentContent"></div>
            <div class="data-right">
              <div class="spacer"></div>
              <span> By: {{ comment.author }} </span>
              <span>At: {{ getDate(comment.currentDate) }}</span>
              <button
                class="alguru-secondary-btn"
                *ngIf="isAdmin || comment.author === loggedInUsername"
                (click)="onDeleteCommentClick(comment)"
              >
                Delete Comment
              </button>
              <button
                class="alguru-secondary-btn"
                *ngIf="isAdmin || comment.author === loggedInUsername"
                (click)="onEditCommentClick(comment)"
              >
                Edit Comment
              </button>
            </div>
          </div>
        </div>
      </div>
      <!--On Edit comment mode-->
      <div *ngIf="comment.onEditPostMode">
        <div class="form-group green-border-focus">
          <label for="titleTextarea4">Title:</label>
          <textarea class="title-input" id="titleTextarea4" rows="1" [(ngModel)]="comment.currentTitle"></textarea>
          <div>Message:</div>
          <angular-editor
            id="editor4"
            [config]="getEditorConfig()"
            [(ngModel)]="comment.currentContent"
          ></angular-editor>
        </div>
        <button class="forum-btn alguru-primary-btn" (click)="onSubmitComment()">
          Submit
        </button>
        <button class="forum-btn alguru-primary-btn" (click)="onEditCommentClick(null)">
          Cancel
        </button>
      </div>
    </div>
    <!--New Comment-->
    <div class="app-error-container">
      <app-error></app-error>
    </div>
    <div class="container">
      <h4>New-Comment</h4>
      <div class="form-group green-border-focus">
        <label for="titleTextarea">Title:</label>
        <textarea
          class="title-input"
          id="titleTextarea"
          rows="1"
          #newCommentTitle
          [(ngModel)]="titleDefaultValue"
        ></textarea>
        <div>Message:</div>
        <angular-editor id="editor2" [config]="getEditorConfig()" [(ngModel)]="messageDefaultValue"></angular-editor>
      </div>
      <button
        class="forum-btn alguru-primary-btn"
        (click)="onSubmitComment(newCommentTitle.value, messageDefaultValue)"
      >
        Submit
      </button>
    </div>
  </div>
</div>
